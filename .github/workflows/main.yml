yaml
name: Didáctico - Instalar Magento 2.4.5
on: workflow_dispatch

jobs:
  install-2-4-5:
    runs-on: ubuntu-latest
    services:
      db:
        image: mariadb:10.6
        env: { MYSQL_ROOT_PASSWORD: root, MYSQL_DATABASE: magento_245 }
        ports: ["3306:3306"]

    steps:
      - name: 1. Crear proyecto desde cero
        run: |
          composer config -g http-basic.repo.magento.com ${{ secrets.M_PUB }} ${{ secrets.M_PRIV }}
          composer create-project --repository-url=https://repo.magento.com magento/project-community-edition=2.4.5 .

      - name: 2. Configurar PHP 8.1
        uses: shivammathur/setup-php@v2
        with: { php-version: '8.1', extensions: bcmath, gd, intl, pdo_mysql, soap, zip }

      - name: 3. Setup Install (Crear Tablas)
        run: |
          bin/magento setup:install \
            --db-host=127.0.0.1 --db-name=magento_245 --db-user=root --db-password=root \
            --base-url=http://localhost/ --admin-user=admin --admin-password=Password123 \
            --admin-email=admin@test.com --admin-firstname=A --admin-lastname=Z

      - name: 4. Verificar Éxito
        run: |
          bin/magento module:status
          echo "¡Magento 2.4.5 instalado y con base de datos lista!"
